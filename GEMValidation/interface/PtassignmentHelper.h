#ifndef GEMCode_GEMValidation_Ptassignment_h
#define GEMCode_GEMValidation_Ptassignment_h

#include "DataFormats/GeometryVector/interface/GlobalPoint.h"

namespace PtassignmentHelper {

//eta partitions:1.2-1.4,1.4-1.6,1.6-1.8, 1.8-2.0, 2.0-2.2, 2.2-2.4
enum {EtaPartitions=6, Parity=4};
//slopes_1 = [1.279, 0.6357, 1.001, 0.5252]
//slopes_2 = [0.640, .353, .555, .310]

const double PositionEpLUT[Parity][EtaPartitions][3] = {
    		//prop_factor, slope, intercept
		{{1.279, 0.04784, 0.1122},
		 {1.279, 0.65424, 0.09761},
    		 {0.640, 0.05527, 0.08944},
		 {0.640, 0.08295, 0.1279},
		 {0.640, 0.1660, 0.2158},
		 {0.640, 0.4952, 0.7103},
		},
		{{0.6357, 0.0827, 0.2021},
		 {0.6357, 0.0906, 0.1773},
		 {0.3530, 0.1067, 0.1957},
		 {0.3530, 0.1561, 0.2645},
		 {0.3530, 0.3156, 0.4514},
		 {0.3530, 0.8242, 1.0712},
		},
		{{1.001, 0.038, 0.008345},
		 {1.001, 0.04157, 0.0617},
		 {0.5550, 0.0562, 0.08417},
		 {0.5550, 0.0870, 0.1426},
		 {0.5550, 0.1676, 0.2198},
		 {0.5550, 0.4953, 0.7272},
		},
		{{0.5252, 0.0739, 0.1714},
		 {0.5252, 0.07838, 0.1307},
		 {0.310, 0.1066, 0.2026},
		 {0.310, 0.1435, 0.2118},
		 {0.310, 0.2874, 0.4055},
		 {0.310, 0.7625, 1.075},
		},
	};

/*const double PositionEpLUT[Parity][EtaPartitions][3] = {
    		//prop_factor, slope, intercept
		{{1.279, 0.04784, 0.1122},
		 {1.279, 0.65424, 0.09761},
    		 {0.648, 0.05527, 0.08944},
		 {0.648, 0.08295, 0.1279},
		 {0.648, 0.1660, 0.2158},
		 {0.648, 0.4952, 0.7103},
		},
		{{0.6357, 0.0827, 0.2021},
		 {0.6357, 0.0906, 0.1773},
		 {0.3542, 0.1067, 0.1957},
		 {0.3542, 0.1561, 0.2645},
		 {0.3542, 0.3156, 0.4514},
		 {0.3542, 0.8242, 1.0712},
		},
		{{1.001, 0.038, 0.008345},
		 {1.001, 0.04157, 0.0617},
		 {0.5636, 0.0562, 0.08417},
		 {0.5636, 0.0870, 0.1426},
		 {0.5636, 0.1676, 0.2198},
		 {0.5636, 0.4953, 0.7272},
		},
		{{0.5252, 0.0739, 0.1714},
		 {0.5252, 0.07838, 0.1307},
		 {0.3217, 0.1066, 0.2026},
		 {0.3217, 0.1435, 0.2118},
		 {0.3217, 0.2874, 0.4055},
		 {0.3217, 0.7625, 1.075},
		},
	};



const double DirectionEpLUT[Parity][EtaPartitions][2]={
    	       {{2.907, 5.906},
		{2.600, 5.191},
		{4.530, 9.422},
		{5.788, 9.743},
		{8.367, 10.22},
		{11.02, 14.84},
	       },
	       {{2.409, 5.198},
		{2.467, 4.397},
		{4.779, 9.954},
		{6.273, 11.91},
		{9.315, 12.21},
		{10.34, 11.02},
	       },
	       {{2.301, 4.929},
		{2.230, 3.111},
		{7.677, 16.82},
		{7.726, 13.36},
		{9.621, 10.62},
		{11.23, 13.44},
	       },
	       {{2.401, 4.758},
		{2.383, 3.782},
		{7.720, 16.91},
		{8.643, 16.45},
		{10.02, 11.83},
		{11.83, 17.66},
	       },
	};
*/

//pt,npar,eta->a,b,anlge,x0,y0
//NPt=1, only for 10GeV
const double HybridDDYAndDeltaPhiLUT[1][Parity][EtaPartitions][5] = {
	{//npt=0
	 {//npar=0
	  {4.800000,0.167578,0.000000,0.078078,-0.001824},//eta 1.2-14.
	  {3.900000,0.224219,0.000000,0.000000,-0.000000},//eta 1.4-1.6
	  {3.000000,0.400000,0.000000,0.000000,-0.000000},//eta 1.6-1.8
	  {2.100000,0.150000,0.000000,0.168925,-0.000937},//eta 1.8-2.0
	  {1.800000,0.600000,0.000000,0.000000,-0.000000},//eta 2.0-2.2
	  {1,1,0,0,0},//eta 2.2-2.4
	  },
	 {//npar=1
	  {2.400000,0.300000,0.000000,0.000000,-0.000000},
	  {2.100000,0.200000,0.000000,0.000000,-0.000000},
	  {1.800000,0.075000,0.000000,0.000000,-0.000000},
	  {1.500000,0.075000,0.000000,0.024682,-0.000272},
	  {1.200000,0.056250,0.000000,0.026576,-0.000284},
	  {1,1,0,0,0},
	 },
	 {//npar=2
	  {4.200000,0.400000,0.000000,0.000000,-0.000000},
	  {3.900000,0.211133,0.000000,0.083966,-0.001333},
	  {2.400000,0.256250,0.000000,0.232345,-0.002233},
	  {2.100000,0.156250,0.000000,0.167997,-0.000450},
	  {1.800000,0.425000,0.000000,0.000000,-0.000000},
	  {1,1,0,0,0},
	 },
	 {//npar=3
	  {3.300000,0.400000,0.000000,0.000000,-0.000000},
	  {1.800000,0.400000,0.000000,0.000000,-0.000000},
	  {1.800000,0.162500,0.000000,0.033521,-0.000329},
	  {1.500000,0.112500,0.000000,0.091360,-0.000374},
	  {1.200000,0.156250,0.000000,0.011796,-0.000057},
	  {1,1,0,0,0},
	 },
        },

};
//updated the LUT, by Tao, 20160724
const double DirectionEpLUT[Parity][EtaPartitions][2]={
    	       {{2.907, 5.906},
		{2.600, 5.191},
		{4.405, 8.809},
		{7.332, 14.478},
		{8.747, 12.265},
		//{11.02, 14.84},
	       },
	       {{2.409, 5.198},
		{2.467, 4.397},
		{4.411, 8.621},
		{7.333, 14.552},
		{8.955, 13.093},
		//{10.34, 11.02},
	       },
	       {{2.301, 4.929},
		{2.230, 3.111},
		{5.288, 10.987},
		{8.242, 16.698},
		{9.213, 13.111},
		//{11.23, 13.44},
	       },
	       {{2.401, 4.758},
		{2.383, 3.782},
		{5.222, 10.769},
		{8.292, 16.955},
		{9.074, 12.083},
		//{11.83, 17.66},
	       },
	};

// phi_momentum = phi_position+gem-csc_bending*slope
const double BendingAngleLUT[2][2] = {
	{28.71,12.86},//even,odd for ME11
	{39.11,18.31},

};

int GetEtaPartition(float eta);

float ellipse(float a, float b,float anlge, float x0, float y0, float x, float y);

float Ptassign_Position(float deltay12, float deltay23, float eta, int par);

float Ptassign_Position_gp(GlobalPoint gp1, GlobalPoint gp2, GlobalPoint gp3, float eta, int par);

float deltaYcalculation(GlobalPoint gp1, GlobalPoint gp2);

float Ptassign_Direction(float bending_12, float eta, int par);

float PhiMomentum(float dphi, float phi_position, int st, bool evenodd);
float PhiMomentum_Radius(float dphi, float phi_position, float radius_csc, float radius_gem);
float PhiMomentum_Xfactor(float dphi, float phi_position, float x);
float PhiMomentum_Xfactor_V2(float phi_CSC, float phi_GEM, float x);


void calculateAlphaBeta(const std::vector<float>& v, 
                        const std::vector<float>& w, 
                        const std::vector<float>& ev, 
                        const std::vector<float>& ew, 
                        const std::vector<float>& status,
                        float& alpha, float& beta);

float normalizePhi(float phi);

}

#endif
